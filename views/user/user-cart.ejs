
<div class="mobile-header-active mobile-header-wrapper-style">
    <div class="mobile-header-wrapper-inner">
        <div class="mobile-header-top">
            <div class="mobile-header-logo">
                <a href="/"><img src="assets/imgs/theme/EzyMart.jpg" alt="logo"></a>
            </div>
            <div class="mobile-menu-close close-style-wrap close-style-position-inherit">
                <button class="close-style search-close">
                    <i class="icon-top"></i>
                    <i class="icon-bottom"></i>
                </button>
            </div>
        </div>
        <div class="mobile-header-content-area">
            
            <div class="mobile-menu-wrap mobile-header-border">
                
                <!-- mobile menu start -->
                <nav>
                    <ul class="mobile-menu">
                        <li class="menu-item-has-children"><span class="menu-expand"></span><a href="/">Home</a>
                            
                        </li>
                        <li class="menu-item-has-children"><span class="menu-expand"></span><a href="/shop">shop</a>
                            
                        </li>
                        
                    </ul>
                </nav>
                <!-- mobile menu end -->
            </div>
            <div class="mobile-header-info-wrap mobile-header-border">
                <div class="single-mobile-header-info mt-30">
                    <a  href="page-contact.html"> Our location </a>
                </div>
                <div class="single-mobile-header-info">
                    <% if (locals.user){%>
                        <a href="/logout">Hi <%= user.name %> | logout</a>
                    <%}else{%>
                       </i><a href="/signin">Log In / Sign Up</a>
                    <%} %>
                </div>
                <div class="single-mobile-header-info">
                    <a href="#">(+01) - 2345 - 6789 </a>
                </div>
            </div>
            <div class="mobile-social-icon">
                <h5 class="mb-15 text-grey-4">Follow Us</h5>
                <a href="/"><img src="assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                <a href="/"><img src="assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                <a href="/"><img src="assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                <a href="/"><img src="assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                <a href="/"><img src="assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
            </div>
        </div>
    </div>
</div>
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html" rel="nofollow">Home</a>
                <span></span> Shop
                <span></span> Your Cart
            </div>
        </div>
    </div>
    <section class="mt-50 mb-50">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <% if(cartItems){%>
                        <% if(cartItems.cartItems.length==0){%>
                            <h2>Your Cart is Empty..</h2>
                        <%}else{%>
                    <div class="table-responsive">
                        <table class="table shopping-summery text-center clean">
                            <thead>
                                <tr class="main-heading">
                                    <th scope="col">Image</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Quantity</th>
                                    <th scope="col">Subtotal</th>
                                    <th scope="col">Remove</th>
                                </tr>
                            </thead>
                            <tbody>
                                
                               
                                <% (locals.cartItems?.cartItems).forEach((items)=>{%>
                                <tr>
                                    <td class="image product-thumbnail"><img src="/images/products_image/<%=items.proId.ProductImages[0] %>" alt="#"></td>
                                    <td class="product-des product-name">
                                        <h5 class="product-name"><a href="shop-product-right.html"><%=items.proId.ProductTitle %></a></h5>
                                        <p class="font-xs"><%=items.proId.ProductDescription %></p>
                                    </td>
                                    <td class="price" data-title="Price"><span>$<%=items.proId.ProductPricing %></span></td>
                                    <td class="text-center" data-title="Stock">
                                        
                                            <button class="cart-item-count ml-4" id="decrement-button" onclick="changeQuantity('<%=cartItems.userId%>','<%=items._id%>',-1,'<%=items.subTotal%>','<%=items.proId.ProductPricing%>')">-</button>
                                            <span class="qty-val" id="<%=items._id %>"><%=items.quantity %></span>
                                            <button class="cart-item-count mr-4" id="increment-button" onclick="changeQuantity('<%=cartItems.userId%>','<%=items._id%>',1,'<%=items.subTotal%>','<%=items.proId.ProductPricing%>')">+</button>
                                            
                                    </td>
                                    <td class="text-right" data-title="Cart">
                                        <span id="cart-subtotal/<%=items._id %>" name="cart-subtotal"><%=items.subTotal %> </span>
                                    </td>
                                    <td class="action" data-title="Remove"><a href="/remove-single-product" onclick="removeSingleProduct('<%=cartItems.userId%>','<%=items._id%>',event)" class="text-muted"><i class="fi-rs-trash"></i></a></td>
                                </tr>
                                <%}) %>
                                
                                <tr>
                                    <td colspan="6" class="text-end">
                                        <a href="/clear-cart/<%=cartItems.userId %>" class="text-muted"> <i class="fi-rs-cross-small"></i> Clear Cart</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="cart-action text-end">
                       
                        <a class="btn " href="/shop"><i class="fi-rs-shopping-bag mr-10"></i>Continue Shopping</a>
                    </div>
                    <div class="divider center_icon mt-50 mb-50"><i class="fi-rs-fingerprint"></i></div>
                    <div class="row mb-50">
                        <div class="col-lg-6 col-md-12">
                            
                        </div>

                        <div class="col-lg-6 col-md-12">
                            <div class="border p-md-4 p-30 border-radius cart-totals">
                                <div class="heading_s1 mb-3">
                                    <h4>Cart Totals</h4>
                                </div>
                                <div class="table-responsive">
                                    <table class="table">
                                        <tbody>
                                            
                                            <tr>
                                                <td class="cart_total_label">Shipping</td>
                                                <td class="cart_total_amount"> <i class="ti-gift mr-5"></i> Free Shipping</td>
                                            </tr>
                                            <tr>
                                                <td class="cart_total_label">Total</td>
                                                <td class="cart_total_amount"><strong><span class="font-xl fw-900 text-brand" id="cart-total"><%=locals.cartItems?.totalAmount %></span></strong></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
     
                                    <a href="/checkout" class="btn "> <i class="fi-rs-box-alt mr-10"></i> Proceed To CheckOut</a>
                                    
                            </div>
                        </div>
                    </div>
                </div>
                <%} %>
                <%}else{%>
                    <h2>Your Cart is Empty..</h2>
                <%} %>
            </div>
        </div>
    </section>
</>
<script>
    function changeQuantity(cartId,proId,count,subTotal,unitPrice){
        let quantity = parseInt(document.getElementById(proId).innerHTML)
        subTotal = parseInt(subTotal)
        unitPrice = parseInt(unitPrice)
        // parseInt(subTotal)
        console.log(proId)
        count = parseInt(count)
        $.ajax({
            url:'/change-product-quantity',
            data:{
                cart:cartId,
                product:proId,
                count:count,
                quantity:quantity,
                subTotal:subTotal,
                unitPrice:unitPrice
            },
            method:'post',
            success:(response)=>{
                console.log(response)
                if(response.response.removeProduct){
                 
                    location.reload()
                }else{
                    document.getElementById(proId).innerHTML = quantity + count;
                    response.cartItems.cartItems.forEach(items=>{
                        if(items._id.toString()===proId.toString()){
                            subTotal= items.subTotal
                        }
                    })
                    document.getElementById(`cart-subtotal/${proId}`).innerHTML = subTotal
                    document.getElementById('cart-total').innerHTML = response.cartItems.totalAmount
                }
            }
            
        })
    }
    function removeSingleProduct(cartId,proId,event){
        event.preventDefault()
        $.ajax({
            url:'remove-single-product',
            data:{
                cart:cartId,
                product:proId
            },
            method:'post',
            success:(response)=>{
                console.log('adfdfafd')
                if(response.response.removeProduct){
                    location.reload()
                }
            }
        })
    }
</script>
